<?xml version="1.0" encoding="UTF-8"?>
<database xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="https://apps.nextcloud.com/schema/apps/database.xsd">

    <!-- LLM Configuration Table -->
    <table>
        <name>*dbprefix*localllm_configs</name>
        <declaration>
            <field>
                <name>id</name>
                <type>integer</type>
                <autoincrement>1</autoincrement>
                <notnull>true</notnull>
                <length>4</length>
            </field>
            <field>
                <name>user_id</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>64</length>
            </field>
            <field>
                <name>name</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>255</length>
            </field>
            <field>
                <name>api_url</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>512</length>
            </field>
            <field>
                <name>api_token_encrypted</name>
                <type>text</type>
                <notnull>false</notnull>
                <length>1024</length>
            </field>
            <field>
                <name>model_name</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>255</length>
            </field>
            <field>
                <name>temperature</name>
                <type>decimal</type>
                <notnull>true</notnull>
                <default>0.7</default>
                <length>3</length>
            </field>
            <field>
                <name>max_tokens</name>
                <type>integer</type>
                <notnull>true</notnull>
                <default>2048</default>
                <length>4</length>
            </field>
            <field>
                <name>system_prompt</name>
                <type>text</type>
                <notnull>false</notnull>
            </field>
            <field>
                <name>max_history_messages</name>
                <type>integer</type>
                <notnull>true</notnull>
                <default>50</default>
                <length>4</length>
            </field>
            <field>
                <name>request_timeout</name>
                <type>integer</type>
                <notnull>true</notnull>
                <default>120000</default>
                <length>4</length>
            </field>
            <field>
                <name>is_default</name>
                <type>boolean</type>
                <notnull>true</notnull>
                <default>0</default>
            </field>
            <field>
                <name>active</name>
                <type>boolean</type>
                <notnull>true</notnull>
                <default>1</default>
            </field>
            <field>
                <name>created_at</name>
                <type>timestamp</type>
                <notnull>true</notnull>
            </field>
            <field>
                <name>updated_at</name>
                <type>timestamp</type>
                <notnull>true</notnull>
            </field>
        </declaration>
    </table>

    <!-- Conversations Table -->
    <table>
        <name>*dbprefix*localllm_conversations</name>
        <declaration>
            <field>
                <name>id</name>
                <type>integer</type>
                <autoincrement>1</autoincrement>
                <notnull>true</notnull>
                <length>4</length>
            </field>
            <field>
                <name>user_id</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>64</length>
            </field>
            <field>
                <name>config_id</name>
                <type>integer</type>
                <notnull>true</notnull>
                <length>4</length>
            </field>
            <field>
                <name>name</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>255</length>
            </field>
            <field>
                <name>active</name>
                <type>boolean</type>
                <notnull>true</notnull>
                <default>1</default>
            </field>
            <field>
                <name>created_at</name>
                <type>timestamp</type>
                <notnull>true</notnull>
            </field>
            <field>
                <name>updated_at</name>
                <type>timestamp</type>
                <notnull>true</notnull>
            </field>
        </declaration>
    </table>

    <!-- Messages Table -->
    <table>
        <name>*dbprefix*localllm_messages</name>
        <declaration>
            <field>
                <name>id</name>
                <type>integer</type>
                <autoincrement>1</autoincrement>
                <notnull>true</notnull>
                <length>4</length>
            </field>
            <field>
                <name>conversation_id</name>
                <type>integer</type>
                <notnull>true</notnull>
                <length>4</length>
            </field>
            <field>
                <name>role</name>
                <type>text</type>
                <notnull>true</notnull>
                <length>32</length>
            </field>
            <field>
                <name>content</name>
                <type>text</type>
                <notnull>true</notnull>
            </field>
            <field>
                <name>tokens_used</name>
                <type>integer</type>
                <notnull>false</notnull>
                <length>4</length>
            </field>
            <field>
                <name>created_at</name>
                <type>timestamp</type>
                <notnull>true</notnull>
            </field>
        </declaration>
    </table>
</database>
